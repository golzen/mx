function required(e){if(null==e)return console.log("Some parameter are missing"),!1}function makeid(e){for(var t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=i.length,a=0;a<e;a++)t+=i.charAt(Math.floor(Math.random()*r));return t}function $v(e,t){return localStorage.getItem(e)&&null==t?localStorage.getItem(e):(localStorage.setItem(e,t),t)}function getFilename(e){if(e)return e.substring(e.lastIndexOf("/")+1)}function getFolderName(e){if(e){var t=e.split("/");return t[t.length-1]}}function getExtension(e){return e.slice(2+(e.lastIndexOf(".")-1>>>0))}function getEditorType(e){var t="";return"html"==e&&(t="htmlmixed"),"css"==e&&(t="css"),"js"==e&&(t="javascript"),""==e&&(t="htmlmixed"),t}function escapeCode(e){return e.replace(/["]/g,"&#34;").replace(/[']/g,"&#39;").replace(/[<]/g,"&lt;").replace(/[>]/g,"&gt;")}function makeHTML(e){return e.replace(/&#34;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">")}function pushUnique(e,t,i,r){for(var a=0;a<e.length;a++)e[a].fileUrl==t?e[a].fileUrl=i:e.push(r)}function ary(){}ary.prototype.map=function(e,t){var i=!0;if(0==e.length)t(e,{});else for(let r in e)if(0==t(e,e[r],r)){i=!1;break}return i};var ary=new ary;function work(){this.funs=[],this.canEngineRun=!0,this.index=0}work.prototype.push=function(e){this.funs.push(e)},work.prototype.start=function(e){var t=this.index;if(this.canEngineRun&&(console.log(this.funs.length+" "+this.funs.length),this.index!=this.funs.length)){var i=this.funs;t=this.index;i.length>0&&"function"==typeof i[t]&&i[t]()}},work.prototype.reset=function(){this.index=0},work.prototype.stop=function(){this.canEngineRun=!1},work.prototype.nxt=function(){this.index=this.index+1,this.start()};var work=new work;function gate(){}gate.prototype.get=function(e){$.ajax({type:"POST",url:e.url,data:e.data,beforeSend:function(e){},success:function(t){e.ondone(t)}})},gate.prototype.read=function(e){this.get(e)};var gate=new gate,dirLoaded=!1;function loadDir(e,t){$.getJSON("server/explorer.php?uri="+e,function(e){var i;rootPath=e.data;var r=makeid(5);$(t.el).attr("token",r);var a="<div class='file_explorer "+r+"'></div>";for(1==t.appendAfter?$(t.el).after(a):$(".file_navigator").append(a),i=0;i<e.folders.length;i++){d=getFolderName(e.folders[i]),"img"!=getFolderName(e.folders[i])&&"logo"!=getFolderName(e.folders[i])&&"image"!=getFolderName(e.folders[i])&&"images"!=getFolderName(e.folders[i])&&"imgs"!=getFolderName(e.folders[i])&&"pictures"!=getFolderName(e.folders[i])||(d="img");var o=' <div class="list fol_typ '+d+'_col" typ="folder" url="'+e.folders[i]+'" title="'+e.folders[i]+'"><span class="material-icons ico">chevron_right</span><span class="material-icons">folder</span><txt>'+getFolderName(e.folders[i])+"</txt></div>";$(".file_navigator ."+r).append(o)}for(i=0;i<e.files.length;i++){var d="";d=getExtension(getFilename(e.files[i])),"png"!=getExtension(getFilename(e.files[i]))&&"jpeg"!=getExtension(getFilename(e.files[i]))&&"jpg"!=getExtension(getFilename(e.files[i]))&&"svg"!=getExtension(getFilename(e.files[i]))&&"gif"!=getExtension(getFilename(e.files[i]))||(d="img");o='<div class="list file_typ '+d+'_fcol" typ="file" url="'+e.files[i]+'" title="'+e.files[i]+'"><span class="material-icons" style="display:none">chevron_right</span><span class="material-icons" style="margin-left:35px;">code</span><txt>'+getFilename(e.files[i])+"</txt></div>";$(".file_navigator ."+r).append(o)}console.log("work started"),dirLoaded=!0})}function openFile(e){var t=e.url.replace(rootPath,"");$.getJSON("server/explorer.php?uri="+t,function(e){console.log(e)})}function editor(){this.data=[],this.activeEditor,localStorage.getItem("fontSize")?this.fontSize=localStorage.getItem("fontSize"):this.fontSize=15}function switchTab(e){}loadDir("/virtual-folio/",{appendAfter:!1}),$("body").on("click",".list",function(){var e=$(this).attr("typ");if("folder"==e)if("true"!=$(this).attr("opened"))if("true"!=$(this).attr("load")){loadDir(r=(r=$(this).attr("url")).replace(rootPath,""),{appendAfter:!0,el:this}),$(this).attr("opened","true"),$(this).find(".ico").html("expand_more"),$(this).attr("load","true")}else{var t=$(this).attr("token");$(this).attr("opened","true"),$(".file_navigator ."+t).css("display","block"),$(this).find(".ico").html("expand_more")}else{t=$(this).attr("token");$(".file_navigator ."+t).css("display","none"),$(this).attr("opened","false"),$(this).find(".ico").html("chevron_right")}if("file"==e){var i=$(this).attr("url");if(localStorage.getItem(i))editor.new({in:tab.activeTab,fileUrl:i,edVal:localStorage.getItem(i)});else{var r=i.replace(rootPath,"");gate.read({url:"server/readFile.php",data:{uri:r},ondone:function(e){editor.new({in:tab.activeTab,fileUrl:i,edVal:e,loaded:"true"})}})}}}),editor.prototype.get=function(e){var t=$("."+("cm_mx_id_"+e)),i=document.querySelector(".cm_mx_id_"+e).CodeMirror.getValue(),r=$(".tab_box[editor_id='"+e+"']").attr("win_id");return{fileUrl:t.attr("file_url"),value:i,loadStat:t.attr("load_stat"),parentTab:r}},editor.prototype.refresh=function(e){setTimeout(function(){try{document.querySelector(".cm_mx_id_"+e).CodeMirror.refresh()}catch(t){console.log({id:e,log:t}),console.trace()}},1)},editor.prototype.setAttr=function(e){var t=e.id,i=e.attr[0],r=e.attr[1];$(".cm_mx_id_"+t).attr(i,r)},editor.prototype.setVal=function(e,t){try{document.querySelector(".cm_mx_id_"+e).CodeMirror.setValue(makeHTML(t))}catch(t){console.log({id:e,log:t}),console.trace()}},editor.prototype.setFontSize=function(e){$(".CodeMirror").css("font-size",e+"px")},editor.prototype.switch=function(e){$(".cm_mx_win_id_"+e.winId).hide(),$(".cm_mx_id_"+e.edId).show(),$("."+e.winId+" .tab_box").removeClass("active"),$(".tab_box[editor_id='"+e.edId+"']").addClass("active"),tab.activeTab=e.winId;var t=e.edId;if("false"==this.get(e.edId).loadStat){var i=this;work.push(function(){var e=i.get(t).fileUrl.replace(rootPath,"");gate.read({url:"server/readFile.php",data:{uri:e},ondone:function(e){i.setVal(t,e),i.setAttr({id:t,attr:["load_stat","true"]}),work.nxt()}})})}this.refresh(t),this.activeEditor=t},editor.prototype.switchAuto=function(e){var t,i;0==$(".tab_box[win_id='"+e.winId+"']").length?(editor.new({in:tabBox.attr("win_id")}),t=0,i=$(".tab_box[win_id='"+e.winId+"']").eq(t).attr("editor_id")):i=0==(t=null==e.index?$(".tab_box[editor_id='"+e.edId+"']").index():e.index)?$(".tab_box[win_id='"+e.winId+"']").eq(t).attr("editor_id"):$(".tab_box[win_id='"+e.winId+"']").eq(t-1).attr("editor_id"),this.switch({edId:i,winId:e.winId})},editor.prototype.switchNext=function(e){var t,i,r=$(".tab_box[win_id='"+e.winId+"']").length;i=(t=null==e.index?$(".tab_box[editor_id='"+e.edId+"']").index():e.index)==r-1?$(".tab_box[win_id='"+e.winId+"']").eq(0).attr("editor_id"):$(".tab_box[win_id='"+e.winId+"']").eq(t+1).attr("editor_id"),this.switch({edId:i,winId:e.winId})},editor.prototype.close=function(e){$(".textArea"+e).remove(),$(".cm_mx_id_"+e).remove();var t=$(".tab_box[editor_id='"+e+"']"),i=t.attr("win_id");$("."+t.attr("win_id")).attr("l",$("."+t.attr("win_id")).attr("l")-1);var r=$(".tab_box[editor_id='"+e+"']").index();t.remove(),this.switchAuto({winId:i,edId:e,index:r}),localStorage.setItem("win_data",escapeCode($(".editorArea").html()))},editor.prototype.new=function(e){var t;console.log("New Ed req: "+e.in),required(e.in),$("."+e.in).attr("l",$("."+e.in).attr("l")-0+1);var i="untitled";if(null!=e.fileUrl&&(i=getFilename(e.fileUrl)),null==e.loaded)if("/untitled"==e.fileUrl)var r="n";else r="false";else r=e.loaded;if(null==e.edVal)var a="";else a=escapeCode(e.edVal);t=a;const o=makeid(10);$("."+e.in+" .tabsArea").append("<div class='tab_box' editor_id='"+o+"' win_id='"+e.in+"'><txt>"+i+"</txt><div class=saved_state_icon></div><span><img src=assets/img/cancel_white_24dp.svg></img></span><div class='clickArea'></div></div>"),console.log("New Tab req: "+i);var d='<div class="win_drager_area win_drager_'+o+'" style="    width: 100%;    height: 100%;    position: absolute;    display:none;    z-index:5;    top:0;"><div class="area" style="    width: 50%;    height: 100%;    position: absolute;    left: 0;" pos="left_fh" ed_id="'+o+'" parent="'+e.in+'"></div><div class="area" style="    width: 50%;    height: 100%;    position: absolute;    right: 0;" pos="right_fh" ed_id="'+o+'" parent="'+e.in+'"></div><div class="area" style="    width: 50%;    height: 50%;    position: absolute;    right: 0;    left:0;    margin:auto" pos="top_fw" ed_id="'+o+'" parent="'+e.in+'"></div><div class="area" style="    width: 50%;    height: 50%;    position: absolute;    bottom: 0;    right: 0;    left:0;    margin:auto" pos="bottom_fw" ed_id="'+o+'" parent="'+e.in+'"></div><div class="area_left_fh prev_area" style="    width: 50%;    height: 100%;    position: absolute;    left: 0;" pos="left_fh" ed_id="'+o+'" parent="'+e.in+'"></div><div class="area_right_fh prev_area" style="    width: 50%;    height: 100%;    position: absolute;    right: 0;" pos="right_fh" ed_id="'+o+'" parent="'+e.in+'"></div><div class="area_top_fw prev_area" style="    width: 100%;    height: 50%;    position: absolute;    right: 0;    left:0;    margin:auto" pos="top_fw" ed_id="'+o+'" parent="'+e.in+'"></div><div class="area_bottom_fw prev_area" style="    width: 100%;    height: 50%;    position: absolute;    bottom: 0;    right: 0;    left:0;    margin:auto" pos="bottom_fw" ed_id="'+o+'" parent="'+e.in+'"></div>    </div>';$("."+e.in+" .editArea").append("<textarea id=textArea"+o+">"+escapeCode(a)+"</textarea>"),$("."+e.in+" .editArea").append(d);var n=getEditorType(getExtension(i)),s=new CodeMirror.fromTextArea($("#textArea"+o)[0],{lineNumbers:!0,lineWrapping:!0,mode:n,gutters:["CodeMirror-lint-markers"],lint:!0,extraKeys:{"'<'":completeAfter,"'/'":completeIfAfterLt,"' '":completeIfInTag,"'='":completeIfInTag,"Ctrl-Space":"autocomplete"},hintOptions:{schemaInfo:tags},autoCloseTags:!0,autoCloseBrackets:!0,theme:"one-dark"});s.on("keydown",function(e,t){}),s.on("change",function(i){t==escapeCode(s.getValue())?(localStorage.setItem(e.fileUrl+"_state","saved"),$(s.getWrapperElement()).attr("saved","true"),$(".tab_box[editor_id='"+o+"']").find(".saved_state_icon").css("background","green")):(localStorage.setItem(e.fileUrl+"_state","unsaved"),$(s.getWrapperElement()).attr("saved","false"),$(".tab_box[editor_id='"+o+"']").find(".saved_state_icon").css("background","orange")),localStorage.setItem(e.fileUrl,s.getValue())}),s.setSize("100%","100%"),$(s.getWrapperElement()).addClass("cm_mx_win_id_"+e.in),$(s.getWrapperElement()).addClass("cm_mx_id_"+o),$(s.getWrapperElement()).attr("ed_id",o),null!=e.fileUrl&&$(s.getWrapperElement()).attr("file_url",e.fileUrl),$(s.getWrapperElement()).attr("load_stat",r),this.switch({edId:o,winId:e.in}),ary.map(this.data,function(t,i){if(0!=i.length&&i.fileUrl==e.fileUrl)return i.parentId=e.in,console.log("Already"),!1})&&this.data.push({fileUrl:e.fileUrl,parentId:e.in,stat:"saved"}),$("#textArea"+o)[0].remove(),localStorage.setItem("editor_data",JSON.stringify(this.data))},editor.prototype.move=function(e){var t=e.axis,i=e.parent,r=tab.info(i).widthRaw,a=tab.info(i).heightRaw;if("left_fh"==t){var o=r/2,d=a;tab.resize({id:i,size:[o,d]}),tab.transferEditor({appendBefore:!0,size:[o,d],parent:i,editorId:e.editorId})}if("right_fh"==t){o=r/2,d=a;tab.resize({id:i,size:[o,d]}),tab.transferEditor({appendAfter:!0,size:[o,d],parent:i,editorId:e.editorId})}if("top_fw"==t){o=r,d=a/2;tab.resize({id:i,size:[o,d]}),tab.transferEditor({appendAfter:!0,size:[o,d],parent:i,editorId:e.editorId})}if("bottom_fw"==t){o=r,d=a/2;tab.resize({id:i,size:[o,d]}),tab.transferEditor({appendAfter:!0,size:[o,d],parent:i,editorId:e.editorId})}this.close(e.editorId)};var editor=new editor;function tab(){this.data=[],this.activeTab="",this.html=[]}tab.prototype.new=function(e){$("."+e.in).append("");var t=makeid(10);""==this.activeTab&&(this.activeTab=t);var i=e.size[0],r=e.size[1];if(r<=98)if(50!=r)var a="border-bottom: 1px solid #333333;";else a="";else a="";if(50==i)var o="border-right: 0px;";else o="";e.appendAfter,e.appendBefore;var d="<div id="+t+" class='editor "+t+"' l=0 style='width:"+i+"%;height: "+r+"%;"+a+o+"'><div class=editorTab selected='false' parent='"+t+"'><div class=tabsArea></div><div class='add_box' parent_id='"+t+"'><img src=assets/img/add_circle_white_24dp.svg></img></div></div><div class=editArea></div> </div>";return null!=e.appendAfter?$("#"+e.parent).after(d):null!=e.appendBefore?$("#"+e.parent).before(d):$(".editorArea").append(d),$("#"+t).attr("w",e.size[0]).attr("h",e.size[1]),editor.new({in:t,fileUrl:e.fileUrl}),this.html.push({data:$(".editorArea").html()}),localStorage.setItem("win_data",escapeCode($(".editorArea").html())),t},tab.prototype.transferEditor=function(e){$("."+e.in).append("");var t=makeid(10),i=e.size[0],r=e.size[1],a=e.editorId,o=editor.get(a).fileUrl,d=editor.get(a).value;if(r<=98)if(50!=r)var n="border-bottom: 1px solid #333333;";else n="";else n="";if(50==i)var s="border-right: 0px;";else s="";e.appendAfter,e.appendBefore;var l="<div id="+t+" class='editor "+t+"' l=0  style='width:"+i+"%;height: "+r+"%;"+n+s+"'><div class=editorTab selected='false' parent='"+t+"'><div class=tabsArea></div><div class='add_box' parent_id='"+t+"'><img src=assets/img/add_circle_white_24dp.svg></img></div></div><div class=editArea></div> </div>";return null!=e.appendAfter?$("#"+e.parent).after(l):null!=e.appendBefore?$("#"+e.parent).before(l):$(".editorArea").append(l),$("#"+t).attr("w",e.size[0]).attr("h",e.size[1]),editor.new({in:t,fileUrl:o,edVal:d}),this.html.push({data:$(".editorArea").html()}),localStorage.setItem("win_data",escapeCode($(".editorArea").html())),t},tab.prototype.resize=function(e){$("#"+e.id).attr("w",e.size[0]).attr("h",e.size[1]),$("#"+e.id).css("width",e.size[0]+"%").css("height",e.size[1]+"%")},tab.prototype.info=function(e){var t=$("#"+e);return{width:t.css("width"),height:t.css("height"),widthRaw:t.attr("w"),heightRaw:t.attr("h")}};var tab=new tab;$("body").on("click",".add_box",function(){var e=$(this).attr("parent_id");editor.new({in:e})}),$("body").on("click",".clickArea",function(){var e=$(this).parent().attr("editor_id"),t=$(this).parent().attr("win_id");editor.switch({edId:e,winId:t})}),$("body").on("mouseover",".tab_box",function(){$(this).find("span").show(),$(this).find(".saved_state_icon").hide()}),$("body").on("mouseleave",".tab_box",function(){$(this).find("span").hide(),$(this).find(".saved_state_icon").show()}),$("body").on("click",".tab_box span",function(){var e=$(this).parent().attr("editor_id");$(this).attr("win_id");editor.close(e)});var sel_ed_id,selected,isDragging=!1;function mx(){this.key=""}$("body").on("mouseup",function(e){isDragging=!1}),$("body").on("mousedown",".tab_box",function(e){isDragging=!0;$(".draggable").outerWidth(),$(".draggable").outerHeight();sel_ed_id=$(this).attr("editor_id"),$("body").on("mousemove",function(e){isDragging?($(".draggable").show(),$(".win_drager_area").css("display","block"),e.pageY>$(".editorArea").offset().top&&e.pageX>$(".editorArea").offset().left&&e.pageY<$(".editorArea").height()&&e.pageX<$(window).width()-25&&($(".area").show(),$(".draggable").offset({top:e.pageY,left:e.pageX}))):$(".draggable").hide()})}),$("body").on("mouseenter",".area",function(){if(isDragging){$(".editArea").css("overflow","hidden");var e=$(this).attr("pos"),t=$(this).attr("ed_id");$(".prev_area").hide(),$(".prev_area").attr("sel","false"),$(".editorTab").css("background","#232323"),$(".area_"+e+"[ed_id='"+t+"']").show(),$(".area_"+e+"[ed_id='"+t+"']").attr("sel","true"),selected="area"}}),$("body").on("mouseenter",".editorTab",function(){isDragging?($(".editArea").css("overflow","auto"),$(".prev_area").hide(),$(".prev_area").attr("sel","false"),$(".editorTab").attr("sel","false"),$(this).attr("sel","true"),$(this).css("background","repeating-linear-gradient(45deg, transparent, transparent 10px, #21252b 10px, #282c34 20px"),selected="panel"):$(".editorTab").css("background","#21252b")}),$("body").on("mouseup",".draggable",function(e){if(isDragging){if("area"==selected){var t=$(".prev_area[sel=true]").attr("parent"),i=sel_ed_id,r=$(".prev_area[sel=true]").attr("pos");editor.move({axis:r,parent:t,editorId:i}),$(".prev_area").hide(),$(".draggable").hide(),$(".win_drager_area").hide(),$(".editorTab").attr("sel","false"),$(".editorTab").css("background","#21252b"),$(".prev_area").attr("sel","false"),$(".editArea").css("overflow","auto"),isDragging=!1,$(".draggable").hide()}if("panel"==selected){t=$(".editorTab[sel=true]").attr("parent"),i=sel_ed_id;var a=editor.get(i).fileUrl,o=editor.get(i).value;editor.new({in:t,fileUrl:a,edVal:o}),editor.close(i),$(".prev_area").hide(),$(".draggable").hide(),$(".win_drager_area").hide(),$(".editorTab").attr("sel","false"),$(".prev_area").attr("sel","false"),$(".editorTab").css("background","#21252b"),isDragging=!1,$(".draggable").hide()}}}),$(document).keydown(function(e){if(187==e.keyCode&&e.ctrlKey){var t=editor.fontSize-0;return editor.fontSize=t+1,editor.setFontSize(editor.fontSize),localStorage.setItem("fontSize",editor.fontSize),$(".CodeMirror").each(function(e,t){t.CodeMirror.refresh()}),!1}if(189==e.keyCode&&e.ctrlKey){t=editor.fontSize-0;return editor.fontSize=t-1,editor.setFontSize(editor.fontSize),localStorage.setItem("fontSize",editor.fontSize),$(".CodeMirror").each(function(e,t){t.CodeMirror.refresh()}),!1}if(83==e.keyCode&&e.altKey){var i=editor.activeEditor;return editor.switchNext({edId:i,winId:editor.get(i).parentTab}),!1}}),editor.setFontSize(editor.fontSize),$(".CodeMirror").each(function(e,t){t.CodeMirror.refresh()}),mx.prototype.init=function(){if(localStorage.getItem("win_data")){var e=makeHTML(localStorage.getItem("win_data"));$(".editorArea").html(e),$(".editorArea .CodeMirror").remove(),$(".editorArea textarea").remove(),$(".editorArea .win_drager_area").remove(),$(".tab_box").remove()}if(localStorage.getItem("editor_data"))var t=localStorage.getItem("editor_data"),i=!0;else i=!1;if(localStorage.removeItem("editor_data"),1==i){t=JSON.parse(t);for(var r=0;r<t.length;r++){var a=t[r].fileUrl,o=t[r].parentId;console.log("id: "+o),editor.new({in:o,fileUrl:a}),localStorage.setItem("win_data",escapeCode($(".editorArea").html()))}}else tab.new({size:[100,100],fileUrl:"/untitled"});work.start()},mx.prototype.ready=function(){dirLoaded&&(clearInterval(infiniteTry),mx.init())};var mx=new mx,infiniteTry=setInterval(mx.ready,800);
